<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>资料库</title>
    <meta name="generator" content="VuePress 1.8.2">
    <link rel="icon" href="/tool-lib/favicon.ico">
    <meta name="description" content="The description of the site.">
    
    <link rel="preload" href="/tool-lib/assets/css/0.styles.5f5c3ce8.css" as="style"><link rel="preload" href="/tool-lib/assets/js/app.b583953d.js" as="script"><link rel="preload" href="/tool-lib/assets/js/3.7849300b.js" as="script"><link rel="preload" href="/tool-lib/assets/js/29.7db43f0f.js" as="script"><link rel="prefetch" href="/tool-lib/assets/js/1.03bf714a.js"><link rel="prefetch" href="/tool-lib/assets/js/10.f307dd50.js"><link rel="prefetch" href="/tool-lib/assets/js/11.ea3d5c61.js"><link rel="prefetch" href="/tool-lib/assets/js/12.9875c4be.js"><link rel="prefetch" href="/tool-lib/assets/js/13.77be9642.js"><link rel="prefetch" href="/tool-lib/assets/js/14.3d20fdff.js"><link rel="prefetch" href="/tool-lib/assets/js/15.27286882.js"><link rel="prefetch" href="/tool-lib/assets/js/16.720891bd.js"><link rel="prefetch" href="/tool-lib/assets/js/17.34cbb9c5.js"><link rel="prefetch" href="/tool-lib/assets/js/18.afa38fe4.js"><link rel="prefetch" href="/tool-lib/assets/js/19.7e859f04.js"><link rel="prefetch" href="/tool-lib/assets/js/20.cfef7b83.js"><link rel="prefetch" href="/tool-lib/assets/js/21.72f5877b.js"><link rel="prefetch" href="/tool-lib/assets/js/22.68e979d0.js"><link rel="prefetch" href="/tool-lib/assets/js/23.4563db56.js"><link rel="prefetch" href="/tool-lib/assets/js/24.3c3a8bea.js"><link rel="prefetch" href="/tool-lib/assets/js/25.71e312df.js"><link rel="prefetch" href="/tool-lib/assets/js/26.4a9ac4f4.js"><link rel="prefetch" href="/tool-lib/assets/js/27.a8c0fefa.js"><link rel="prefetch" href="/tool-lib/assets/js/28.8758ce6e.js"><link rel="prefetch" href="/tool-lib/assets/js/30.f4f5593e.js"><link rel="prefetch" href="/tool-lib/assets/js/31.eafcc806.js"><link rel="prefetch" href="/tool-lib/assets/js/32.e9d75eca.js"><link rel="prefetch" href="/tool-lib/assets/js/33.0eb1d715.js"><link rel="prefetch" href="/tool-lib/assets/js/34.28257c90.js"><link rel="prefetch" href="/tool-lib/assets/js/4.46bdd5a9.js"><link rel="prefetch" href="/tool-lib/assets/js/5.dc44ba0f.js"><link rel="prefetch" href="/tool-lib/assets/js/6.346a31c1.js"><link rel="prefetch" href="/tool-lib/assets/js/7.53588745.js"><link rel="prefetch" href="/tool-lib/assets/js/8.9a92f05c.js"><link rel="prefetch" href="/tool-lib/assets/js/9.afea9637.js">
    <link rel="stylesheet" href="/tool-lib/assets/css/0.styles.5f5c3ce8.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/tool-lib/" class="home-link router-link-active"><img src="/tool-lib/logo.svg" alt="资料库" class="logo"> <span class="site-name can-hide">资料库</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/tool-lib/" class="nav-link">
  HOME
</a></div><div class="nav-item"><a href="/tool-lib/web/" class="nav-link">
  WEB
</a></div><div class="nav-item"><a href="/tool-lib/css/" class="nav-link">
  CSS
</a></div><div class="nav-item"><a href="/tool-lib/help/" class="nav-link router-link-active">
  HELP
</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/tool-lib/" class="nav-link">
  HOME
</a></div><div class="nav-item"><a href="/tool-lib/web/" class="nav-link">
  WEB
</a></div><div class="nav-item"><a href="/tool-lib/css/" class="nav-link">
  CSS
</a></div><div class="nav-item"><a href="/tool-lib/help/" class="nav-link router-link-active">
  HELP
</a></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/tool-lib/help/link.html" class="sidebar-link">链接</a></li><li><section class="sidebar-group collapsable depth-0"><a href="/tool-lib/help/cmd" class="sidebar-heading clickable router-link-active open"><span>命令</span> <span class="arrow down"></span></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/tool-lib/help/cmd/vue.html" class="sidebar-link">vue</a></li><li><a href="/tool-lib/help/cmd/gitlab.html" aria-current="page" class="active sidebar-link">gitlab</a></li></ul></section></li><li><a href="/tool-lib/help/cfg.html" class="sidebar-link">配置</a></li><li><a href="/tool-lib/help/code.html" class="sidebar-link">代码</a></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><ul><li>查看版本号</li></ul> <div class="language- extra-class"><pre class="language-text"><code>cat /opt/gitlab/embedded/service/gitlab-rails/VERSION
</code></pre></div><ul><li>修改外部访问IP</li></ul> <div class="language- extra-class"><pre class="language-text"><code>vi /etc/gitlab/gitlab.rb
external_url 'http://192.168.234.128'
</code></pre></div><ul><li><p>git仓库文件保存的目录：
<code>/var/opt/gitlab/git-data</code></p></li> <li><p>修改root密码</p></li></ul> <div class="language- extra-class"><pre class="language-text"><code>gitlab-rails console -e production
user = User.where(id: 1).first
user.password = '12345678'
user.password_confirmation = '12345678'
user.save!
exit
</code></pre></div><ul><li>数据备份</li></ul> <div class="language- extra-class"><pre class="language-text"><code>vi /etc/gitlab/gitlab.rb

gitlab_rails['manage_backup_path'] = true                  #292行      开启备份功能
gitlab_rails['backup_path'] = &quot;/opt/gitlab_backup&quot;         #293行      指定备份的路径
gitlab_rails['backup_archive_permissions'] = 0644          #296行      备份文件的权限
gitlab_rails['backup_keep_time'] = 7776000                 #301行      备份保留时间（保留90天）

gitlab-ctl reconfigure
</code></pre></div><ul><li>手动备份：</li></ul> <div class="language- extra-class"><pre class="language-text"><code>gitlab-rake gitlab:backup:create
</code></pre></div><ul><li>查看备份文件</li></ul> <div class="language- extra-class"><pre class="language-text"><code>ll /var/opt/gitlab/backups/
</code></pre></div><ul><li>定时备份到
<code>192.168.234.1:E:\tmp</code></li></ul> <div class="language- extra-class"><pre class="language-text"><code>vi /opt/gitlabscp.sh

#!/bin/sh

scp_linux_path='/var/opt/gitlab/backups/'
scp_windows_uri='user@192.168.234.1:E:\tmp'
scp_log_path='/opt/gitlabscp.log'

time=$(date +%Y-%m-%d\ %H:%M:%S)
gitlab-rake gitlab:backup:create
filename=`ls $scp_linux_path -t |head -n1|awk '{print $0}'`
echo [$time] $scp_linux_path$filename &gt;&gt; $scp_log_path
scp $scp_linux_path$filename $scp_windows_uri
</code></pre></div><ul><li>定时任务</li></ul> <div class="language- extra-class"><pre class="language-text"><code>crontab -e
0 1 * * * /opt/gitlabscp.sh
</code></pre></div><ul><li>恢复数据
<ul><li>停止相关服务</li></ul></li></ul> <div class="language- extra-class"><pre class="language-text"><code>gitlab-ctl stop unicorn
gitlab-ctl stop sidekiq
修改备份文件权限
chmod 777 /var/opt/gitlab/backups/1530156812_2018_06_28_10.8.4_gitlab_backup.tar
执行恢复
gitlab-rake gitlab:backup:restore BACKUP=1530156812_2018_06_28_10.8.4
</code></pre></div><ul><li>备份到云存储
<blockquote><p>从GitLab7.4开始，可以将备份文件上传到远端云存储上。
具体配置和操作，可查看官方文档：</p></blockquote> <ul><li>涉及的配置项如下：</li></ul></li></ul> <div class="language- extra-class"><pre class="language-text"><code>393  # gitlab_rails['backup_upload_connection'] = {
394  #   'provider' =&gt; 'AWS',
395  #   'region' =&gt; 'eu-west-1',
396  #   'aws_access_key_id' =&gt; 'AKIAKIAKI',
397  #   'aws_secret_access_key' =&gt; 'secret123'
398  # }
399  # gitlab_rails['backup_upload_remote_directory'] = 'my.s3.bucket'
400  # gitlab_rails['backup_multipart_chunk_size'] = 104857600
</code></pre></div><ul><li>邮件服务：</li></ul> <div class="language- extra-class"><pre class="language-text"><code>gitlab_rails['smtp_enable'] = true
gitlab_rails['smtp_address'] = &quot;smtp.sina.com&quot;
gitlab_rails['smtp_port'] = 465
gitlab_rails['smtp_user_name'] = &quot;webappdesign@sina.com&quot;
gitlab_rails['smtp_password'] = &quot;d009e4cb446ba182&quot;
gitlab_rails['smtp_domain'] = &quot;sina.com&quot;
gitlab_rails['smtp_authentication'] = &quot;login&quot;
gitlab_rails['smtp_enable_starttls_auto'] = true
gitlab_rails['smtp_tls'] = true
gitlab_rails['smtp_pool'] = false
gitlab_rails['gitlab_email_enabled'] = true

gitlab_rails['gitlab_email_from'] = 'webappdesign@sina.com'

gitlab_rails['gitlab_email_reply_to'] = 'webappdesign@sina.com'

gitlab-rails console
Notify.test_email('8230459@qq.com', 'Message Subject', 'Message Body').deliver_now
</code></pre></div><ul><li>新浪邮箱授权码
<code>d009e4cb446ba182</code></li></ul></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/tool-lib/help/cmd/vue.html" class="prev">
        vue
      </a></span> <span class="next"><a href="/tool-lib/help/cfg.html">
        配置
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"><!----></div></div>
    <script src="/tool-lib/assets/js/app.b583953d.js" defer></script><script src="/tool-lib/assets/js/3.7849300b.js" defer></script><script src="/tool-lib/assets/js/29.7db43f0f.js" defer></script>
  </body>
</html>
