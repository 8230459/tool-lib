(window.webpackJsonp=window.webpackJsonp||[]).push([[29],{811:function(a,t,s){"use strict";s.r(t);var l=s(44),e=Object(l.a)({},(function(){var a=this,t=a.$createElement,s=a._self._c||t;return s("ContentSlotsDistributor",{attrs:{"slot-key":a.$parent.slotKey}},[s("ul",[s("li",[a._v("查看版本号")])]),a._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("cat /opt/gitlab/embedded/service/gitlab-rails/VERSION\n")])])]),s("ul",[s("li",[a._v("修改外部访问IP")])]),a._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("vi /etc/gitlab/gitlab.rb\nexternal_url 'http://192.168.234.128'\n")])])]),s("ul",[s("li",[s("p",[a._v("git仓库文件保存的目录：\n"),s("code",[a._v("/var/opt/gitlab/git-data")])])]),a._v(" "),s("li",[s("p",[a._v("修改root密码")])])]),a._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("gitlab-rails console -e production\nuser = User.where(id: 1).first\nuser.password = '12345678'\nuser.password_confirmation = '12345678'\nuser.save!\nexit\n")])])]),s("ul",[s("li",[a._v("数据备份")])]),a._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("vi /etc/gitlab/gitlab.rb\n\ngitlab_rails['manage_backup_path'] = true                  #292行      开启备份功能\ngitlab_rails['backup_path'] = \"/opt/gitlab_backup\"         #293行      指定备份的路径\ngitlab_rails['backup_archive_permissions'] = 0644          #296行      备份文件的权限\ngitlab_rails['backup_keep_time'] = 7776000                 #301行      备份保留时间（保留90天）\n\ngitlab-ctl reconfigure\n")])])]),s("ul",[s("li",[a._v("手动备份：")])]),a._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("gitlab-rake gitlab:backup:create\n")])])]),s("ul",[s("li",[a._v("查看备份文件")])]),a._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("ll /var/opt/gitlab/backups/\n")])])]),s("ul",[s("li",[a._v("定时备份到\n"),s("code",[a._v("192.168.234.1:E:\\tmp")])])]),a._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("vi /opt/gitlabscp.sh\n\n#!/bin/sh\n\nscp_linux_path='/var/opt/gitlab/backups/'\nscp_windows_uri='user@192.168.234.1:E:\\tmp'\nscp_log_path='/opt/gitlabscp.log'\n\ntime=$(date +%Y-%m-%d\\ %H:%M:%S)\ngitlab-rake gitlab:backup:create\nfilename=`ls $scp_linux_path -t |head -n1|awk '{print $0}'`\necho [$time] $scp_linux_path$filename >> $scp_log_path\nscp $scp_linux_path$filename $scp_windows_uri\n")])])]),s("ul",[s("li",[a._v("定时任务")])]),a._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("crontab -e\n0 1 * * * /opt/gitlabscp.sh\n")])])]),s("ul",[s("li",[a._v("恢复数据\n"),s("ul",[s("li",[a._v("停止相关服务")])])])]),a._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("gitlab-ctl stop unicorn\ngitlab-ctl stop sidekiq\n修改备份文件权限\nchmod 777 /var/opt/gitlab/backups/1530156812_2018_06_28_10.8.4_gitlab_backup.tar\n执行恢复\ngitlab-rake gitlab:backup:restore BACKUP=1530156812_2018_06_28_10.8.4\n")])])]),s("ul",[s("li",[a._v("备份到云存储\n"),s("blockquote",[s("p",[a._v("从GitLab7.4开始，可以将备份文件上传到远端云存储上。\n具体配置和操作，可查看官方文档：")])]),a._v(" "),s("ul",[s("li",[a._v("涉及的配置项如下：")])])])]),a._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("393  # gitlab_rails['backup_upload_connection'] = {\n394  #   'provider' => 'AWS',\n395  #   'region' => 'eu-west-1',\n396  #   'aws_access_key_id' => 'AKIAKIAKI',\n397  #   'aws_secret_access_key' => 'secret123'\n398  # }\n399  # gitlab_rails['backup_upload_remote_directory'] = 'my.s3.bucket'\n400  # gitlab_rails['backup_multipart_chunk_size'] = 104857600\n")])])]),s("ul",[s("li",[a._v("邮件服务：")])]),a._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("gitlab_rails['smtp_enable'] = true\ngitlab_rails['smtp_address'] = \"smtp.sina.com\"\ngitlab_rails['smtp_port'] = 465\ngitlab_rails['smtp_user_name'] = \"webappdesign@sina.com\"\ngitlab_rails['smtp_password'] = \"d009e4cb446ba182\"\ngitlab_rails['smtp_domain'] = \"sina.com\"\ngitlab_rails['smtp_authentication'] = \"login\"\ngitlab_rails['smtp_enable_starttls_auto'] = true\ngitlab_rails['smtp_tls'] = true\ngitlab_rails['smtp_pool'] = false\ngitlab_rails['gitlab_email_enabled'] = true\n\ngitlab_rails['gitlab_email_from'] = 'webappdesign@sina.com'\n\ngitlab_rails['gitlab_email_reply_to'] = 'webappdesign@sina.com'\n\ngitlab-rails console\nNotify.test_email('8230459@qq.com', 'Message Subject', 'Message Body').deliver_now\n")])])]),s("ul",[s("li",[a._v("新浪邮箱授权码\n"),s("code",[a._v("d009e4cb446ba182")])])])])}),[],!1,null,null,null);t.default=e.exports}}]);